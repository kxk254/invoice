

{% load static %}
{% block style %}
    

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style> 
    /* @page {
        size: A4;
        margin: 1cm; 
    } */

    body {
        font-size: 13px;
    }
    .image-container {
            position: absolute;
            top: 4.8cm;
            right: 4cm;
            z-index: 10; 
    }

    .image-container img {
        width: 2.5cm;  
        height: auto;
        position: relative;
        top: 0cm;
        left: 3cm;
    }


</style>
{% endblock %}

{% block content %}

{% load custom_filters %}
<div class="m-3">

    <div class="d-flex justify-content-center mt-3 mb-5">
        <div>
            <h2>請求書</h2>
        </div>
    </div>
    <div class="d-flex justify-content-between">
        <div>
            <span style="text-decoration: underline;font-size: 18px; font-weight: 800;">{{ selected_company }} 御中</span>
        </div>


        <div class="me-5">
            <h7>請求書番号 {{ invoice_num|format_id }}</h7><br>
            <h7>請求書発行日 {{ today|japan_day_format }}</h7>
        </div>
    </div>

    <div class="d-flex justify-content-end mt-3 me-5 pe-3">
        <div>
            <span>登録番号: {{register_no}}</span><br>
            <span style="font-size: 16px; font-weight: 800;">{{my_company}}</span><br>
            <span>〒 {{post_code}}</span><br>
            <div class="image-container"><img src="{% static 'images/soliton_stamp.png' %}"></div>
            <span>{{address1}}</span><br>
            <span>{{address2}}</span><br>
            <span>TEL: {{tel}}</span><br>
            <span>E-mail: {{email}}</span><br>
        </div>
    </div>

    <div class="d-flex justify-content-between">
        <div>
            <div class="border border-dark border-2 rounded m-3 p-2">
                <h6 class="ms-2 me-2 mt-1">ご請求合計額 金 {{ total_at_gttl|format_with_000s }}円</h6>
                <span class="ms-3">お支払期日: {{ payment_due|japan_last_day_format }}</span>
            </div>
            
        </div>

        <div>
            <div class="border border-dark border-2 rounded m-3">
                <div class="p-1">
                    <span  class="small" style="text-decoration: underline;">振込先：以下の口座にお支払いください</span><br>
                    <span  class="small">銀行名：{{bank_name}}</span><br>
                    <span  class="small">支店名：{{branch_name}}({{branch_code}})</span><br>
                    <span  class="small">預金種別：{{account_type}}</span><br>
                    <span  class="small">口座番号：{{account_number}}</span><br>
                    <span  class="small">口座名義人：{{account_name}}</span><br>
                    <span  class="small">（{{account_name_kana}} ）</span> 
                </div>
            </div>

        </div>
    </div>

    

    
    <form method="POST" action="#">
        {% csrf_token %}
        <input type="hidden" name="slug" value="{{ slug }}">
        
        <table class="table table-striped table-sm" >
            <tr>
                <th>請求明細</th>
                <th style="text-align: right;">税率</th>
                <th style="text-align: right;">金　額</th>
                 <!-- <th class="ps-2">備考</th> -->
            </tr>
        
            {% for record in object %}
                <tr>
                    <td>{{ record.action_name }} - <span style="font-size: 12px;">{{ record.action_date|japan_month_format }}  {{ record.action_note|caseclean }}</span> </td>
                    <td style="font-size: 12px; text-align: right;">{{ record.item_code.tax_rate|format_with_000s  }}</td>
                    <td style="font-size: 12px; text-align: right;">{{ record.invoice_bt|format_with_000s  }}</td>
                    <!-- <td class="ps-2" style="font-size: 10px;">{{ record.売上_id.備考|caseclean }}</td> -->
                    <td style="display: none;">
                        <input type="hidden" name="contract_{{ forloop.counter0 }}" value="{{ record.contract }}">
                        <input type="hidden" name="bukken_{{ forloop.counter0 }}" value="{{ record.bukken }}">
                        <input type="hidden" name="tenant_{{ forloop.counter0 }}" value="{{ record.tenant.id }}">
                        <input type="hidden" name="invoice_bt_{{ forloop.counter0 }}" value="{{ record.invoice_bt }}">
                        <input type="hidden" name="invoice_tax_{{ forloop.counter0 }}" value="{{ record.invoice_tax }}">
                        <input type="hidden" name="invoice_at_{{ forloop.counter0 }}" value="{{ record.invoice_at }}">
                        <input type="hidden" name="report_date_{{ forloop.counter0 }}" value="{{ record.report_date }}">
                    </td>
                </tr>
            {% empty %}
                <tr><td colspan="6">No records found.</td></tr>
            {% endfor %}
            <tr style="border-top: 2px solid black;border-bottom: 2px solid black; color: black;">
                <td>合計</td>
                <td></td>
                <td style="font-size: 12px; text-align: right;">{{ total_bt_gttl|format_with_000s  }}</td>  <!-- Display the total amount -->
            </tr>
        </table>

        <div style="width: 100%; display: flex; justify-content: flex-end;">
            <div style="display: flex; flex-direction: column;  align-items: flex-end; gap: 20px;">
                <div style="display: flex; align-items: flex-start;">

                    <span>税率毎の明細</span>

                    <table class="ms-2" style="font-size: 12px; border: 1px solid black; width: 400px ">
                        <tr>
                            <th style="text-align: right; border: 1px solid black;" >税率</th>
                            <th style="text-align: right; border: 1px solid black;">金額（円）</th>
                            <th style="text-align: right; border: 1px solid black;">消費税額（円）</th>
                            <th style="text-align: right; border: 1px solid black;">合計（円）</th>
                        </tr>
                        {% if total_bt_gttl_0 > 0 %}
                        <tr>
                            <td style="text-align: right; border: 1px solid black;">無税</td>
                            <td style="text-align: right; border: 1px solid black;">{{ total_bt_gttl_0|format_with_000s }}</td>
                            <td style="text-align: right; border: 1px solid black;">0</td>
                            <td style="text-align: right; border: 1px solid black;">{{ total_bt_gttl_0|format_with_000s }}</td>
                        </tr>
                        {% endif %}
                        {% if total_tax > 0 %}
                        <tr>
                            <td style="text-align: right; border: 1px solid black;">10%</td>
                            <td style="text-align: right; border: 1px solid black;">{{ total_amount_bt|format_with_000s }}</td>
                            <td style="text-align: right; border: 1px solid black;">{{ total_tax|format_with_000s }}</td>
                            <td style="text-align: right; border: 1px solid black;">{{ total_amount_at|format_with_000s }}</td>
                        </tr>
                        {% endif %}
                    </table>
                </div>
                
                <div class="mt-2">
                    <span class="small">*上記金額をご請求申し上げます。領収書は、振込銀行の発行する「振込金受領書」をもって代えさせて頂きます。</span><br>
                    <span class="small">*振込手数料は別途ご負担ください。</span>
                </div>
            </div>
        </div>
        <!-- <h7 class="d-flex justify-content-end me-3">お客様コード： {{ tenant_id }} </h7> -->

        <!-- <p><strong>Selected Property:</strong> {{ selected_bukken }}</p> -->
        <!-- <p><strong>Selected Month:</strong> {{ selected_month }}</p> -->

        {% if 'pdf_key' not in request.POST %}
            <!-- This will show only if pdf_key is not set -->
            <input type="hidden" name="slug" value="{{ slug }}">
            <button type="submit" name="create_pdf">Create PDF</button>
        {% endif %}
    </form>

</div>
{% endblock %}